{% extends "base.html" %}
{% block title %}Admin Dashboard | Pawradise{% endblock %}
{% block content %}
<section class="admin">
  <h2>Admin Dashboard</h2>
  <p>Welcome, {{ session['username'] }}! Manage your store below.</p>

  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-icon"></div>
      <div class="stat-info">
        <h3>{{ total_orders }}</h3>
        <p>Total Orders</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon"></div>
      <div class="stat-info">
        <h3>₱{{ "%.2f"|format(total_sales) }}</h3>
        <p>Total Sales</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">️</div>
      <div class="stat-info">
        <h3>{{ products|length }}</h3>
        <p>Total Products</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-info">
        <h3>{{ all_users|length }}</h3>
        <p>Total Users</p>
      </div>
    </div>
  </div>

  <h3> Manage Products</h3>
  <div class="table-container">
    <table class="product-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Image</th>
          <th>Name</th>
          <th>Price</th>
          <th>Stock</th>
          <th>Sales</th>
          <th>Category</th>
          <th>Description</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% if products %}
          {% for p in products %}
          <tr>
            <form action="{{ url_for('update_product', id=p.id) }}" method="POST">
              <td>{{ p.id }}</td>
              <td>
                {% if p.image %}
                <img src="{{ url_for('static', filename=p.image) }}" alt="{{ p.name }}" style="width:60px;height:60px;object-fit:cover;border-radius:4px;">
                {% else %}
                <span>No image</span>
                {% endif %}
              </td>
              <td><input type="text" name="name" value="{{ p.name }}" required class="table-input"></td>
              <td><input type="number" step="0.01" name="price" value="{{ p.price }}" required class="table-input" style="width:100px;"></td>
              <td><input type="number" name="stock" value="{{ p.stock }}" required class="table-input" style="width:80px;"></td>
              <td>{{ p.sales_count }}</td>
              <td>{{ p.category or 'N/A' }}</td>
              <td><input type="text" name="description" value="{{ p.description }}" class="table-input" style="width:200px;"></td>
              <td>
                <button type="submit" class="update-btn">Update</button>
                <a href="{{ url_for('delete_product', id=p.id) }}" class="delete-btn" onclick="return confirm('Delete this product?')">Delete</a>
              </td>
            </form>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="9">No products available.</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <h3> All Customer Orders</h3>
  <div class="table-container">
    <table class="product-table">
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Customer</th>
          <th>Product</th>
          <th>Quantity</th>
          <th>Unit Price</th>
          <th>Total Price</th>
          <th>Contact</th>
          <th>Date</th>
          <th>Est. Delivery</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% if all_orders %}
          {% for order in all_orders %}
          <tr>
            <td>{{ order.id }}</td>
            <td>{{ order.customer_name }}</td>
            <td>{{ order.product_name }}</td>
            <td>{{ order.quantity }}</td>
            <td>₱{{ "%.2f"|format(order.unit_price) }}</td>
            <td>₱{{ "%.2f"|format(order.total_price) }}</td>
            <td>{{ order.contact_number }}</td>
            <td>{{ order.date_of_purchase.strftime("%Y-%m-%d") }}</td>
            <td>{{ order.estimated_delivery.strftime("%Y-%m-%d") }}</td>
            <td>
              <span class="status-badge status-{{ order.status.lower() }}">
                {{ order.status }}
              </span>
            </td>
            <td>
              <form action="{{ url_for('update_order_status', id=order.id) }}" method="POST" style="display:inline;">
                <select name="status" onchange="this.form.submit()" class="status-select">
                  <option value="Pending" {% if order.status == 'Pending' %}selected{% endif %}>Pending</option>
                  <option value="Confirmed" {% if order.status == 'Confirmed' %}selected{% endif %}>Confirmed</option>
                  <option value="Shipped" {% if order.status == 'Shipped' %}selected{% endif %}>Shipped</option>
                  <option value="Delivered" {% if order.status == 'Delivered' %}selected{% endif %}>Delivered</option>
                  <option value="Cancelled" {% if order.status == 'Cancelled' %}selected{% endif %}>Cancelled</option>
                </select>
              </form>
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="11">No orders yet.</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <h3>Manage User Accounts</h3>
  <div class="table-container">
    <table class="product-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Username</th>
          <th>Email</th>
          <th>Role</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for user in all_users %}
        <tr>
          <td>{{ user.id }}</td>
          <td>{{ user.username }}</td>
          <td>{{ user.email }}</td>
          <td>
            <span class="role-badge role-{{ user.role }}">{{ user.role }}</span>
          </td>
          <td>
            {% if user.role not in ['admin', 'owner'] %}
            <a href="{{ url_for('delete_user', id=user.id) }}" class="delete-btn" onclick="return confirm('Delete this user account?')">Delete</a>
            {% else %}
            <span class="disabled-text">Protected</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}